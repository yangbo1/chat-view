<!doctype html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/styles.css">
<script src="js/sockjs.js"></script>
<script src="js/core.js"></script>
<script src="js/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.js"></script>
<script src="jquery.qqFace.js"></script>
<link rel="stylesheet" href="css/info.css" />
</head>
<body>

<div id="chatbox" class="ui-mobile-viewport ui-overlay-c">
	<div id="friendslist">
		<div id="topmenu">
			<span onclick="openInfo()" id='myInfo'><strong>我的资料</strong></span>
		</div>
		
		<div id="friends" style="height:414px;overflow:auto">
		</div>                

	</div>	
	
	<div id="chatview" class="p1">    	
		<div id="profile">

			<div id="close">
				<div class="cy"></div>
				<div class="cx"></div>
			</div>
			
			<p>Miro Badev</p>
			<span>miro@badev@gmail.com</span>
		</div>
		<div id="chat-messages">
		</div>
		<span class="emotion"></span>
		<div id="sendmessage">
			<textarea class="input" id="message"></textarea>
			<button id="send"></button>
		</div>
	

	</div>

	<div id="info" style="display: none">

		<div class="banner">
			<img src="img/banner.jpg" />
		</div>
		<div id="close1">
			<div class="cy"></div>
			<div class="cx"></div>
		</div>
		<ul class="information">
			<h2>基本信息</h2>
			<form id="form">
				<li>
					<label>账&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 号：</label>
					<span maxlength="100" id="name1"></span>
				</li>
			<li>
				<label>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 名：</label>
				<input class="infor-input" placeholder="" type="text"  maxlength="100" id="realName" name="realName" />
			</li>
			<li>
				<label>性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 别：</label>
				<input id="man" type="radio" checked="" name="gender" value="男"/>男
				<input id="woman" type="radio" checked="" name="gender" value="女"/>女
			</li>
			<li>
				<label>签&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 名：</label>
				<input class="infor-input" placeholder="" maxlength="100" id="remark" name="remark" type="text" />
			</li>
			<li>
				<label>手&nbsp;&nbsp;机&nbsp;&nbsp;号：</label>
				<input class="infor-input" placeholder="" type="text" maxlength="100" id="phone" name="phone" />
			</li>
			<!--<li>-->
				<!--<label>微&nbsp;&nbsp;信&nbsp;&nbsp;号：</label>-->
				<!--<input class="infor-input" placeholder="" type="text" maxlength="100" id="wechat" name="wechat" />-->
			<!--</li>-->
			<li>
				<label>院&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 校：</label>
				<input class="infor-input" placeholder="" maxlength="100" id="school" name="school" type="text" />
			</li>
			<li>
				<label>职&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 业：</label>
				<input class="infor-input" placeholder="" maxlength="100" id="career" name="career" type="text" />
			</li>
			<li>
				<label>工作地点：</label>
				<input class="infor-input" placeholder="" maxlength="50" id="jobAddress" name="jobAddress" type="text" />
			</li>
			</form>
		</ul>
		<a class="submit-btn">保存</a>
	</div>
</div>

<script type="text/javascript">
    !function(J){function H(){var d=E.getBoundingClientRect().width;var e=(d/7.5>100*B?100*B:(d/7.5<42?42:d/7.5));E.style.fontSize=e+"px",J.rem=e}var G,F=J.document,E=F.documentElement,D=F.querySelector('meta[name="viewport"]'),B=0,A=0;if(D){var y=D.getAttribute("content").match(/initial\-scale=([\d\.]+)/);y&&(A=parseFloat(y[1]),B=parseInt(1/A))}if(!B&&!A){var u=(J.navigator.appVersion.match(/android/gi),J.navigator.appVersion.match(/iphone/gi)),t=J.devicePixelRatio;B=u?t>=3&&(!B||B>=3)?3:t>=2&&(!B||B>=2)?2:1:1,A=1/B}if(E.setAttribute("data-dpr",B),!D){if(D=F.createElement("meta"),D.setAttribute("name","viewport"),D.setAttribute("content","initial-scale="+A+", maximum-scale="+A+", minimum-scale="+A+", user-scalable=no"),E.firstElementChild){E.firstElementChild.appendChild(D)}else{var s=F.createElement("div");s.appendChild(D),F.write(s.innerHTML)}}J.addEventListener("resize",function(){clearTimeout(G),G=setTimeout(H,300)},!1),J.addEventListener("pageshow",function(b){b.persisted&&(clearTimeout(G),G=setTimeout(H,300))},!1),H()}(window);
    if (typeof(M) == 'undefined' || !M){
        window.M = {};
    }
</script>
<script language="javascript">
    function sc(){
        var div = document.getElementById("chat-messages");
//        div.innerText += "\n" + (i++).toString(); //可以不要
        div.scrollTop = div.scrollHeight;
    }
</script>
<script type="text/javascript">
    $(function(){
        $('.emotion').qqFace({
                                 id : 'facebox', //表情盒子的ID
                                 assign:'message', //给那个控件赋值
                                 path:'face/'	//表情存放的路径
                             });
        $(".sub_btn").click(function(){
            var str = $("#message").val();
//            $("#show").html(replace_em(str));
        });
    });
    //查看结果
    function replace_em(str){
        str = str.replace(/\</g,'&lt;');
        str = str.replace(/\>/g,'&gt;');
        str = str.replace(/\n/g,'<br/>');
        str = str.replace(/\[em_([0-9]*)\]/g,'<img src="face/$1.gif" border="0" />');
        return str;
    }
</script>
<script>
	var chatNotes = [];
	var selfImg = "";
	var onlineFriends = [];
	var hehefs = [
		{
		    name: "haha",
			img: "img/haha.jpg",
			sign: "im haha"
		},
		{
		    name: "aaa",
			img: "img/aaa.jpg",
			sign: "im aaa"
		}
	]
	var hahafs = [
		{
		    name: "hehe",
			img: "img/hehe.jpg",
			sign: "im hehe"
		}
	]
	var aaafs = [
		{
		    name: "hehe",
			img: "img/hehe.jpg",
			sign: "im hehe"
		}
	]

    function getParam(paramName) {
        paramValue = "";
        isFound = false;
        if (this.location.search.indexOf("?") == 0 && this.location.search.indexOf("=") > 1) {
            arrSource = unescape(this.location.search).substring(1, this.location.search.length).split("&");
            i = 0;
            while (i < arrSource.length && !isFound) {
                if (arrSource[i].indexOf("=") > 0) {
                    if (arrSource[i].split("=")[0].toLowerCase() == paramName.toLowerCase()) {
                        paramValue = arrSource[i].split("=")[1];
                        isFound = true;
                    }
                }
                i++;
            }
        }
        return paramValue;
    }
    var user = getParam("user");
	var nowName = "";
    function ready() {
        var preloadbg = document.createElement('img');
        preloadbg.src = 'img/timeline1.png';
        $('#searchfield').focus(function () {
            if ($(this).val() == 'Search contacts...') {
                $(this).val('');
            }
        });
        $('#searchfield').focusout(function () {
            if ($(this).val() == '') {
                $(this).val('Search contacts...');
            }
        });
        $('#sendmessage input').focus(function () {
            if ($(this).val() == 'Send message...') {
                $(this).val('');
            }
        });
        $('#sendmessage input').focusout(function () {
            if ($(this).val() == '') {
                $(this).val('Send message...');
            }
        });
        $('.friend').each(function () {
            $(this).click(function () {
                var childOffset = $(this).offset();
                var parentOffset = $(this).parent().parent().offset();
                var childTop = childOffset.top - parentOffset.top;
                var clone = $(this).find('img').eq(0).clone();
                var top = childTop + 12 + 'px';
                $(clone).css({ 'top': top }).addClass('floatingImg').appendTo('#chatbox');
                $(clone).removeAttr("onclick");
                setTimeout(function () {
                    $('#profile p').addClass('animate');
                    $('#profile').addClass('animate');
                }, 100);
                setTimeout(function () {
                    $('#chat-messages').addClass('animate');
                    $('.cx, .cy').addClass('s1');
                    setTimeout(function () {
                        $('.cx, .cy').addClass('s2');
                    }, 100);
                    setTimeout(function () {
                        $('.cx, .cy').addClass('s3');
                    }, 200);
                }, 150);
                $('.floatingImg').animate({
                                              'width': '68px',
                                              'left': '42%',
                                              'top': '20px'
                                          }, 200);
                var name = $(this).find('p strong').html();
                var email = $(this).find('p span').html();
                $('#profile p').html(name);
                $('#profile span').html(email);

                $('.message').not('.right').find('img').attr('src', $(clone).attr('src'));
                $('#friendslist').fadeOut();
                $('#chat-messages').empty();
                if (chatNotes[name] == null) {
                    $.ajax({
						type: "POST",
						url: config.url.findChatMessage,
						dataType: "json",
						data: {
						    "userA": user,
							"userB": name,
							"pageIndex": 0
						},
						success: function (data) {
							if (data) {
							    for(var i = 0; i < data.length; i ++) {
                                    analysisMessage(data[i].chatMessage)
                                }
							}
                        }
						   })
				}
                $('#chat-messages').append(chatNotes[name]);
                nowName = name;
                $('#chatview').fadeIn();
                //让聊天窗口滚动到底部
                sc();
                $('#close').unbind('click').click(function () {
                    nowName = "";
                    $('#chat-messages, #profile, #profile p').removeClass('animate');
                    $('.cx, .cy').removeClass('s1 s2 s3');
                    $('.floatingImg').animate({
                                                  'width': '40px',
                                                  'top': top,
                                                  'left': '12px'
                                              }, 200, function () {
                        $('.floatingImg').remove();
                    });
                    setTimeout(function () {
                        $('#chatview').fadeOut();
                        $('#friendslist').fadeIn();
                    }, 50);
                });

            });
        });
    }
	$(document).ready(function () {
//	user = Page.URL.getParameter("user");
//	ready();
});

	var wsServer = null;
	var ws = null;
	wsServer = config.url.server+ user;
	ws = new WebSocket(wsServer); //创建WebSocket对象
	if (ws == null) {
	    alert("aaa")
	}
	ws.onopen = function (evt) {
	    console.log(evt)
		addFriendList(evt.data);

//		layer.msg("已经建立连接", { offset: 0});
	};
	ws.onmessage = function (evt) {
        console.log(evt)
		analysisMessage(evt.data);  //解析后台传回的消息,并予以展示
	};
	ws.onerror = function (evt) {
        console.log(evt)
//		layer.msg("产生异常", { offset: 0});
		window.location.href = "user/login.html"
	};
	ws.onclose = function (evt) {
        console.log(evt)
        window.location.href = "user/login.html"
//		layer.msg("已经关闭连接", { offset: 0});
//        alert("连接已断开")
	};
	//
    function addFriendList(data) {
//    var friend1 = "<div class='friend'>" +
//               		"<img src='img/1_copy.jpg'/>" +
//                        "<p>" +
//							"<strong>haha</strong>"+
//						   "<span>mirobadev@gmail.com</span>" +
//						"</p>" +
//						"<div class='status available'></div>" +
//				   "</div>";
//        var friend2 = "<div class='friend'>" +
//                     "<img src='img/2_copy.jpg'/>" +
//                     "<p>" +
//                     "<strong>hehe</strong>"+
//                     "<span>fuck</span>" +
//                     "</p>" +
//                     "<div class='status available'></div>" +
//                     "</div>";

//        $("#friends").empty();
        var friend = "";
        if (!$("#group").length > 0) {
            friend +=  "<div class='friend' id='group'>" +
                       "<img src='img/group.jpg' />" +
                       "<p>" +
                       "<strong>群聊</strong>"+
                       "<span>(二胡卵子们来聊天啊)</span>" +
                       "</p>" +
                       "<div class='status available' id='status'></div>" +
                       "</div>";
		}

		if (data) {
            for (var i = 0; i < data.length; i ++) {
                var na = "\""+data[i].name+"\"";
                if ($.inArray(data[i].name, onlineFriends) != -1){
                    if ($("#f"+data[i].name+"").length > 0) {
                        $("#f"+data[i].name+"").find('div[id^="status"]').attr("class", "status available")
                    } else {
                        friend +=  "<div class='friend' id='f"+data[i].name+"'>" +
                                   "<img src='"+data[i].img+"' onclick='openInfo("+na+")'/>" +
                                   "<p>" +
                                   "<strong>"+data[i].name+"</strong>"+
                                   "<span>("+data[i].remark+")</span>" +
                                   "</p>" +
                                   "<div class='status available' id='status'></div>" +
                                   "</div>";
//                        onlineFriends.push(data[i].name)
                    }
				} else {
                    if ($("#f" + data[i].name + "").length > 0) {
                        $("#f" + data[i].name + "").find('div[id^="status"]').attr("class", "status inactive")
                    }else {
                    friend += "<div class='friend' id='f" + data[i].name + "'>" +
                              "<img src='" + data[i].img + "' onclick='openInfo("+na+")'/>" +
                              "<p>" +
                              "<strong>" + data[i].name + "</strong>" +
                              "<span>(" + data[i].remark + ")</span>" +
                              "</p>" +
                              "<div class='status inactive' id='status'></div>" +
                              "</div>";
//                        onlineFriends.push(data[i].name)
                }
				}

            }
            $("#friends").append(friend)
		}

//        if (user == "hehe") {
//
//            for (var i = 0; i < hehefs.length; i ++) {
//				friend +=  "<div class='friend'>" +
//                              "<img src='"+hehefs[i].img+"'/>" +
//                              "<p>" +
//                              "<strong>"+hehefs[i].name+"</strong>"+
//                              "<span>"+hehefs[i].sign+"</span>" +
//                              "</p>" +
//                              "<div class='status available'></div>" +
//                              "</div>";
//            }
//            $("#friends").append(friend)
//		}
//		if (user == "haha") {
//            for (var i = 0; i < hahafs.length; i ++) {
//                friend +=  "<div class='friend'>" +
//                           "<img src='"+hahafs[i].img+"'/>" +
//                           "<p>" +
//                           "<strong>"+hahafs[i].name+"</strong>"+
//                           "<span>"+hahafs[i].sign+"</span>" +
//                           "</p>" +
//                           "<div class='status available'></div>" +
//                           "</div>";
//            }
//            $("#friends").append(friend)
//		}
//		if (user == "aaa") {
//            for (var i = 0; i < aaafs.length; i ++) {
//                friend +=  "<div class='friend'>" +
//                           "<img src='"+aaafs[i].img+"'/>" +
//                           "<p>" +
//                           "<strong>"+aaafs[i].name+"</strong>"+
//                           "<span>"+aaafs[i].sign+"</span>" +
//                           "</p>" +
//                           "<div class='status available'></div>" +
//                           "</div>";
//            }
//            $("#friends").append(friend)
//		}
		ready();
    }
    function removeFriend(data) {
        if ($.inArray(data, onlineFriends) != -1) {
//            $("#f"+data+"").remove();
            $("#f"+data+"").find('div[id^="status"]').attr("class", "status inactive")
            onlineFriends.splice($.inArray(data,onlineFriends),1);
            ready();
		}

    }
    /**
	 * 连接
	 */
	function getConnection(){
		if(ws == null){
			ws = new WebSocket(wsServer); //创建WebSocket对象
			ws.onopen = function (evt) {
//				layer.msg("成功建立连接!", { offset: 0});
//				addFriendList(evt.data);
			};
			ws.onmessage = function (evt) {
				analysisMessage(evt.data);  //解析后台传回的消息,并予以展示
			};
			ws.onerror = function (evt) {
				layer.msg("产生异常", { offset: 0});
			};
			ws.onclose = function (evt) {
				layer.msg("已经关闭连接", { offset: 0});
			};
		}else{
			layer.msg("连接已存在!", { offset: 0, shift: 6 });
		}
	}

	/**
	 * 关闭连接
	 */
	function closeConnection(){
		if(ws != null){
			ws.close();
			ws = null;
			$("#list").html("");    //清空在线列表
			layer.msg("已经关闭连接", { offset: 0});
		}else{
			layer.msg("未开启连接", { offset: 0, shift: 6 });
		}
	}

	/**
	 * 检查连接
	 */
	function checkConnection(){
		if(ws != null){
			layer.msg(ws.readyState == 0? "连接异常":"连接正常", { offset: 0});
		}else{
			layer.msg("连接未开启!", { offset: 0, shift: 6 });
		}
	}
	$("#send").click(function () {
		sendMessage();
        $("#message").val("");
    })
    //为keyListener方法注册按键事件
    document.onkeydown=keyListener;
    function keyListener(e){
        // 当按下回车键，执行我们的代码
        if(e.keyCode == 13){
            //我们要做的事情
            sendMessage();
            $("#message").val("");
        }
    }
	/**
	 * 发送信息给后台
	 */
	function sendMessage(){
		if(ws == null){
			alert("连接失败");
			return;
		}
		var message = $("#message").val();
        var to = $('#profile p').html();
        console.log(to)
//		var to = $("#sendto").text() == "全体成员"? "": $("#sendto").text();
		if(message == null || message == ""){
			alert("请输入");
			return;
		}
//		$("#tuling").text() == "已上线"? tuling(message):console.log("图灵机器人未开启");  //检测是否加入图灵机器人
		ws.send(JSON.stringify({
								   message : {
									   content : message,
									   from : user,
									   to : to,      //接收人,如果没有则置空,如果有多个接收人则用,分隔
									   time : new Date().getTime()
								   },
								   type : "message"
							   }));
	}

	/**
	 * 解析后台传来的消息
	 * "massage" : {
		 *              "from" : "xxx",
		 *              "to" : "xxx",
		 *              "content" : "xxx",
		 *              "time" : "xxxx.xx.xx"
		 *          },
	 * "type" : {notice|message},
	 * "list" : {[xx],[xx],[xx]}
	 *
	 *     <div class="message">
				 <img src="img/1_copy.jpg" />
				 <div class="bubble">
				 Really cool stuff!
				 <div class="corner"></div>
				 <span>3 min</span>
				 </div>
			</div>

				 <div class="message right">
				 <img src="img/2_copy.jpg" />
				 <div class="bubble">
				 Can you share a link for the tutorial?
				 <div class="corner"></div>
				 <span>1 min</span>
				 </div>
				 </div>
	 */

	function analysisMessage(message){
		message = JSON.parse(message);
		if(message.type == "message"){      //会话消息
//			showChat(message.message);

			var data = message.message;
			var content = data.content;
			var to = data.to;
			var from = data.from;
			var time = timestampToTime(data.time);
            console.log(content,to,time)

			var left = "<br><label>"+time+"</label>"+
				"<div class='message'>" +
						   "<img class='img1' src='"+selfImg+"' />"+
                "<span>"+from+"</span>" +
						   "<div class='bubble'>"+
                       replace_em(content) +
							   "<div class='corner'></div>" +
//							   "<span>"+from +":"+ time +"</span>" +
						   "</div>" +
                       "</div>";

			var right = "<br><label>"+time+"</label>"+
				"<div class='message right'>" +
							  "<img class='img1' src='"+selfImg+"' />"+
                "<span>"+from+"</span>" +
							   "<div class='bubble'>"+
                        replace_em(content) +
									"<div class='corner'></div>" +
//								   "<span>"+from +":"+ time +"</span>" +
							   "</div>" +
					    "</div>";
            if (to == user) {
                if (nowName == from) {
                    $("#chat-messages").append(left);
                    var chatNote = $("#chat-messages").html();
                    chatNotes[from] = chatNote;
                } else {
                    var chatNote = chatNotes[from];
                    chatNote += left;
                    chatNotes[from] = chatNote;
				}

			} else if (from == user){
                $("#chat-messages").append(right);
                var chatNote = $("#chat-messages").html();
                chatNotes[to] = chatNote;
            }
            if (to == "群聊" && from != user) {
                $("#chat-messages").append(left);
                var chatNote = $("#chat-messages").html();
                chatNotes["群聊"] = chatNote;
			}

		}else if (message.type == "id"){
		    var id = message.id
            selfImg = message.img;
		    var online = message.online;
		    onlineFriends = online;
		    console.log(onlineFriends)
			$.ajax({
				type: "POST",
				dataType: "json",
				url: config.url.frineds ,
			    traditional: true,
				data: {
                    "online": online,
                    "self": user
                },
				success: function (data) {
//					console.log(data)
                    addFriendList(data)
                }
				   })
		} else if (message.type == "off"){
			console.log(message)
			removeFriend(message.message)
		}
		//让聊天窗口滚动到底部
		sc();
		if(message.type == "notice"){       //提示消息
//			showNotice(message.message);
		}
		if(message.list != null && message.list != undefined){      //在线列表
//			showOnline(message.list);
		}
	}
    function timestampToTime(timestamp) {

//        Y = date.getFullYear() + '-';
//        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
//        D = date.getDate() + ' ';
//        h = date.getHours() + ':';
//        m = date.getMinutes() + ':';
//        s = date.getSeconds();
//        return Y+M+D+h+m+s;
		var date = new Date(timestamp);
        var datetime = date.toLocaleTimeString();//时间戳为10位需*1000，时间戳为13位的话不需乘1000
        var year = date.getFullYear();
        var mon = date.getMonth();
        var daym = date.getDate(); //1-31
        var day = date.getDay();//0 1 2 3 4 5 6 星期天到星期六
		function day7(d) {
			switch (d) {
				case 0 : return  "星期天"
				case 1 : return  "星期一"
				case 2 : return "星期二"
				case 3 : return  "星期三"
				case 4 : return "星期四"
				case 5 : return "星期五"
				case 6 : return "星期六"
			}
        }
        var now = new Date();
		var nowyear = now.getFullYear();
		var nowmon = now.getMonth();
		var nowdaym = now.getDate()
        var nowday = now.getDay();
		if (nowyear == year) {//今年
			if (nowmon == mon) {//本月
			    if (nowdaym - daym < 7) {//一周内
			        if(nowdaym - daym == 1) {//昨天
                        return "昨天 " + datetime
					} else if (nowdaym - daym == 0) {//今天
							return datetime
						}
						else {
                            return day7(day) + " " + datetime
                        }

				} {
                    return mon + "-" + daym + " " +datetime
				}
			} else {
                return mon + "-" + daym + " " +datetime
			}
		} else {
		    return year +"-" + mon + "-" + daym + " " +datetime
		}

    }
//    timestampToTime(1403058804);
//    console.log(timestampToTime(1403058804));//2014-06-18 10:33:24
    /**
	 * 个人信息
     */
    function openInfo(name) {
        e = window.event || e;
        if (e.stopPropagation) {
            e.stopPropagation();      //阻止事件 冒泡传播
        } else {
            e.cancelBubble = true;   //ie兼容
        }
        if (!name) {
            var url = config.url.info + "/"+user
		} else {
            var url = config.url.info + "/"+name
		}

        setTimeout(function () {
//            $('#chat-messages').addClass('animate');
            $('.cx, .cy').addClass('s1');
            setTimeout(function () {
                $('.cx, .cy').addClass('s2');
            }, 100);
            setTimeout(function () {
                $('.cx, .cy').addClass('s3');
            }, 200);
        }, 150);
//        if (!name){
//            $('#friendslist').fadeOut();
//        } else {
//            $("#chat-messages").fadeOut();
//		}
//        $("#info").fadeIn()
        $('#friendslist').fadeOut();
		$("#info").fadeIn();
		$.ajax({
			type: "get",
			url: url,
			success:function (data) {
//				console.log(data)
				if (data) {
					$("#realName").val(data.realName)
					$("#name1").text(data.name)
					if (data.gender == "男") {$("#man").attr("checked", true)}
					if (data.gender == "女") {$("#woman").attr("checked", true)}
					$("#remark").val(data.remark)
					$("#phone").val(data.phone)
					$("#wehcat").val(data.wechat)
					$("#jobAddress").val(data.jobAddress)
					$("#career").val(data.career)
					$("#school").val(data.school)
//					$("#wechat").val(data.wechat)
					if (data.name != user) {
                        $(".submit-btn").hide()
						$("#info input").each(function () {
							$(this).attr("disabled", "disabled")
                        })
					} else {
                        $(".submit-btn").show()
                        $("#info input").each(function () {
                            $(this).removeAttr("disabled", "disabled")
                        })
					}
				}
            }

			   })
        $('#close1').unbind('click').click(function () {
            $('.cx, .cy').removeClass('s1 s2 s3');
            setTimeout(function () {

                $('#info').hide();
//                if (!name) {
//                    $('#friendslist').fadeIn();
//                } else {
//                    $("#chat-messages").fadeIn();
//				}
                $('#friendslist').fadeIn();
            }, 50);
        });
    }
    $(".submit-btn").click(function () {
        var realName = $("#realName").val()
		var gender = $("input[name='gender']:checked").val()
        var remark = $("#remark").val()
        var phone = $("#phone").val()
//        var wechat = $("#wechat").val()
        var jobAddress = $("#jobAddress").val()
		var career = $("#career").val()
        var school = $("#school").val();
        data1 = {
            "realName": realName,
			"gender": gender,
			"remark": remark,
			"phone": phone,
//			"wechat": wechat,
			"jobAddress": jobAddress,
			"career": career,
			"school": school,
//			"img": "",
			"name": user
        },
		$.ajax({
			type: "POST",
			url: config.url.edit,
			dataType: "json",
		    contentType: "application/json",
		    traditional: true,
			data: JSON.stringify(data1),
			success: function (data) {
			    if (data == "0") {
			        alert("保存成功")
				} else {
			        alert("保存失败，请重试")
				}
            }
			   })
    })
</script>

</body>
</html>
